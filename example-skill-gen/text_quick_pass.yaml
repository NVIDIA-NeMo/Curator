# Text Quick Pass Pipeline
# Generated by CURATOR-OS /curate skill
#
# MINIMAL filtering for fast quality pass:
# - WordCountFilter: Remove very short (<50 words) or very long (>100K words) docs
# - NonAlphaNumericFilter: Remove docs with >25% non-alphanumeric characters
#
# Usage:
#   python -m nemo_curator.config.run --config-path=. --config-name=text_quick_pass \
#     input_path=/data/raw output_path=/data/filtered
#
# Expected filtering: ~5-15% of documents removed (depends on data quality)

defaults:
  - _self_
  - override hydra/job_logging: none
  - override hydra/hydra_logging: none

hydra:
  run:
    dir: .
  output_subdir: null

# Configuration (override on command line)
input_path: ???  # Required: path to input data
output_path: ???  # Required: path for output
text_field: "text"

# Ray Client Configuration
ray_client:
  _target_: nemo_curator.core.client.RayClient
  num_cpus: null  # Use all available
  num_gpus: 0  # CPU-only for heuristic filters

# Pipeline Stages
stages:

  # ========================================
  # Stage 1: Read Data
  # ========================================
  # Parquet (default)
  - _target_: nemo_curator.stages.text.io.reader.ParquetReader
    file_paths: ${input_path}

  # For JSONL, comment above and uncomment below:
  # - _target_: nemo_curator.stages.text.io.reader.JsonlReader
  #   file_paths: ${input_path}

  # ========================================
  # Stage 2: Minimal Filtering
  # ========================================

  # Filter 1: Word count (50-100K words)
  # Removes: empty docs, stubs, and extremely long docs
  - _target_: nemo_curator.stages.text.modules.ScoreFilter
    filter_obj:
      _target_: nemo_curator.stages.text.filters.WordCountFilter
      min_words: 50
      max_words: 100000
    text_field: ${text_field}

  # Filter 2: Non-alphanumeric ratio (< 25%)
  # Removes: garbled text, encoding errors, symbol spam
  - _target_: nemo_curator.stages.text.modules.ScoreFilter
    filter_obj:
      _target_: nemo_curator.stages.text.filters.NonAlphaNumericFilter
      max_non_alpha_numeric_to_text_ratio: 0.25
    text_field: ${text_field}

  # ========================================
  # Stage 3: Write Output
  # ========================================
  - _target_: nemo_curator.stages.text.io.writer.ParquetWriter
    path: ${output_path}
