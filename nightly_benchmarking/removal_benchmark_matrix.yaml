# Matrix configuration for removal benchmark
# Usage: python nightly_benchmarking/bench_driver.py --matrix nightly_benchmarking/removal_benchmark_matrix.yaml --datasets nightly_benchmarking/dataset_paths.json

default_timeout_s: 3600  # 1 hour timeout
results_dir: /raid/benchmarks/ray-curator/removal-results
artifacts_dir: /raid/benchmarks/ray-curator/removal-artifacts

# MLflow configuration
mlflow:
  tracking_uri: ${MLFLOW_TRACKING_URI}
  experiment: ray-curator-removal

# Slack notifications (optional)
slack:
  webhook_env: SLACK_WEBHOOK_URL

entries:
  # Ray Data executor with curator dedup IDs
  - name: removal_curator_dedup_id_ray_data_1gb_use_initial
    script: removal_benchmark.py
    args: >-
      --input-path {dataset:cleaned_cc,jsonl}
      --ids-to-remove-path /raid/adattagupta/NeMo-Curator/ray-curator/ray_curator/fuzzy_dedup_output/FuzzyDuplicateIds/
      --id-generator-path /raid/adattagupta/NeMo-Curator/ray-curator/ray_curator/fuzzy_dedup_output/fuzzy_id_generator.json
      --output-path {session}/scratch
      --executor ray_data
      --input-filetype jsonl
      --output-filetype parquet
      --id-field _curator_dedup_id
      --duplicate-id-field _curator_dedup_id
      --blocksize 1GiB
      --use-initial-tasks
    timeout_s: 7200
    ray:
      num_cpus: 32
      num_gpus: 0
      enable_object_spilling: false

  # Ray Data executor with curator dedup IDs
  - name: removal_curator_dedup_id_ray_data_1gb_use_file_partitioning
    script: removal_benchmark.py
    args: >-
      --input-path {dataset:cleaned_cc,jsonl}
      --ids-to-remove-path /raid/adattagupta/NeMo-Curator/ray-curator/ray_curator/fuzzy_dedup_output/FuzzyDuplicateIds/
      --id-generator-path /raid/adattagupta/NeMo-Curator/ray-curator/ray_curator/fuzzy_dedup_output/fuzzy_id_generator.json
      --output-path {session}/scratch
      --executor ray_data
      --input-filetype jsonl
      --output-filetype parquet
      --id-field _curator_dedup_id
      --duplicate-id-field _curator_dedup_id
      --blocksize 1GiB
    timeout_s: 7200
    ray:
      num_cpus: 32
      num_gpus: 0
      enable_object_spilling: false

  # Xenna executor with curator dedup IDs
  - name: removal_curator_dedup_id_xenna_1gb_use_initial
    script: removal_benchmark.py
    args: >-
      --input-path {dataset:cleaned_cc,jsonl}
      --ids-to-remove-path /raid/adattagupta/NeMo-Curator/ray-curator/ray_curator/fuzzy_dedup_output/FuzzyDuplicateIds/
      --id-generator-path /raid/adattagupta/NeMo-Curator/ray-curator/ray_curator/fuzzy_dedup_output/fuzzy_id_generator.json
      --output-path {session}/scratch
      --executor xenna
      --input-filetype jsonl
      --output-filetype parquet
      --id-field _curator_dedup_id
      --duplicate-id-field _curator_dedup_id
      --blocksize 1GiB
      --use-initial-tasks
    timeout_s: 7200
    ray:
      num_cpus: 32
      num_gpus: 0
      enable_object_spilling: false

  # Xenna executor with curator dedup IDs
  - name: removal_curator_dedup_id_xenna_1gb_use_file_partitioning
    script: removal_benchmark.py
    args: >-
      --input-path {dataset:cleaned_cc,jsonl}
      --ids-to-remove-path /raid/adattagupta/NeMo-Curator/ray-curator/ray_curator/fuzzy_dedup_output/FuzzyDuplicateIds/
      --id-generator-path /raid/adattagupta/NeMo-Curator/ray-curator/ray_curator/fuzzy_dedup_output/fuzzy_id_generator.json
      --output-path {session}/scratch
      --executor xenna
      --input-filetype jsonl
      --output-filetype parquet
      --id-field _curator_dedup_id
      --duplicate-id-field _curator_dedup_id
      --blocksize 1GiB
    timeout_s: 7200
    ray:
      num_cpus: 32
      num_gpus: 0
      enable_object_spilling: false
